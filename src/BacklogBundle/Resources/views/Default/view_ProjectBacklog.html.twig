{% extends 'backend.html.twig' %}
{% block topnavbar %}
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <!------ Include the above in your HEAD tag ---------->

    <script language="JavaScript" src="https://code.jquery.com/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script language="JavaScript" src="https://cdn.datatables.net/1.10.4/js/jquery.dataTables.min.js" type="text/javascript"></script>
    <script language="JavaScript" src="https://cdn.datatables.net/plug-ins/3cfcc339e89/integration/bootstrap/3/dataTables.bootstrap.js" type="text/javascript"></script>



    <!-- fixed-top-->
    <nav class="header-navbar navbar-expand-md navbar navbar-with-menu navbar-without-dd-arrow fixed-top navbar-semi-light">
        <div class="navbar-wrapper">
            <div class="navbar-container content">
                <div class="collapse navbar-collapse show" id="navbar-mobile">
                    <ul class="nav navbar-nav mr-auto float-left">
                        <li class="nav-item d-block d-md-none"><a class="nav-link nav-menu-main menu-toggle hidden-xs" href="#"><i class="ft-menu"></i></a></li>
                        <li class="nav-item d-none d-md-block"><a class="nav-link nav-link-expand" href="#"><i class="ficon ft-maximize"></i></a></li>
                        <li class="nav-item dropdown navbar-search"><a class="nav-link dropdown-toggle hide" data-toggle="dropdown" href="#"><i class="ficon ft-search"></i></a>
                            <ul class="dropdown-menu">
                                <li class="arrow_box">
                                    <form>
                                        <div class="input-group search-box">
                                            <div class="position-relative has-icon-right full-width">
                                                <input class="form-control" id="test" type="text" placeholder="Search here...">
                                                <div class="form-control-position navbar-search-close"><i class="ft-x">   </i></div>
                                            </div>
                                        </div>
                                    </form>
                                </li>
                            </ul>
                        </li>
                    </ul>
                    <ul class="nav navbar-nav float-right">
                        <li class="dropdown dropdown-language nav-item"><a class="dropdown-toggle nav-link" id="dropdown-flag" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="flag-icon flag-icon-us"></i><span class="selected-language"></span></a>
                            <div class="dropdown-menu" aria-labelledby="dropdown-flag">
                                <div class="arrow_box"><a class="dropdown-item" href="#"><i class="flag-icon flag-icon-us"></i> English</a><a class="dropdown-item" href="#"><i class="flag-icon flag-icon-cn"></i> Chinese</a><a class="dropdown-item" href="#"><i class="flag-icon flag-icon-ru"></i> Russian</a><a class="dropdown-item" href="#"><i class="flag-icon flag-icon-fr"></i> French</a><a class="dropdown-item" href="#"><i class="flag-icon flag-icon-es"></i> Spanish</a></div>
                            </div>
                        </li>
                    </ul>
                    <ul class="nav navbar-nav float-right">

                        <li class="dropdown dropdown-notification nav-item show">
                            <a class="nav-link nav-link-label" href="#" data-toggle="dropdown" aria-expanded="true">
                                <i class="ficon ft-bell bell-shake" id="notification-navbar-link"></i>
                                <span class="badge badge-pill badge-sm badge-danger badge-up badge-glow">{{ mgilet_notification_unseen_count(app.user) }}</span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-media dropdown-menu-right show">
                                <div class="arrow_box_right">
                                    <li class="dropdown-menu-header">
                                        <h6 class="dropdown-header m-0"><span class="grey darken-2">Notifications</span></h6>
                                    </li>
                                    <li class="scrollable-container media-list w-100 ps">
                                            {{ mgilet_notification_render(app.user,{ 'template': 'Notifications/notifications.html.twig', 'seen': false  }) }}
                                    </li>
                                    <li class="dropdown-menu-footer"><a class="dropdown-item info text-right pr-1" href="javascript:void(0)">Read all</a></li>
                                </div>
                            </ul>
                        </li>







                        <li class="dropdown dropdown-notification nav-item"><a class="nav-link nav-link-label" href="#" data-toggle="dropdown"><i class="ficon ft-mail">             </i></a>
                            <div class="dropdown-menu dropdown-menu-right">
                                <div class="arrow_box_right"><a class="dropdown-item" href="#"><i class="ft-book"></i> Read Mail</a><a class="dropdown-item" href="#"><i class="ft-bookmark"></i> Read Later</a><a class="dropdown-item" href="#"><i class="ft-check-square"></i> Mark all Read       </a></div>
                            </div>
                        </li>
                        <li class="dropdown dropdown-user nav-item"><a class="dropdown-toggle nav-link dropdown-user-link" href="#" data-toggle="dropdown">             <span class="avatar avatar-online"><img src="{{ asset('theme-assets/images/portrait/small/avatar-s-19.jpg') }}" alt="avatar"><i></i></span></a>
                            <div class="dropdown-menu dropdown-menu-right">
                                <div class="arrow_box_right"><a class="dropdown-item" href="#"><span class="avatar avatar-online"><img src="{{ asset('theme-assets/images/portrait/small/avatar-s-19.jpg') }}" alt="avatar"><span class="user-name text-bold-700 ml-1">John Doe</span></span></a>
                                    <div class="dropdown-divider"></div><a class="dropdown-item" href="#"><i class="ft-user"></i> Edit Profile</a><a class="dropdown-item" href="#"><i class="ft-mail"></i> My Inbox</a><a class="dropdown-item" href="#"><i class="ft-check-square"></i> Task</a><a class="dropdown-item" href="#"><i class="ft-message-square"></i> Chats</a>
                                    <div class="dropdown-divider"></div><a class="dropdown-item" href="#"><i class="ft-power"></i> Logout</a>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>
{% endblock %}


{% block body %}


    <div class="app-content content align-content-center">
        <div class="content-wrapper ">
            <div class="content-header row">
            </div>
            <div class="content-body"><!-- Chart -->
                <div class="col-12">    </div>
                <div class="col-12">    </div>
                <div class="col-12">    </div>
                <div class="col-12">    </div>
                <p>


                </p>

                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title">Backlog du {{ backlog.project.projetName }}  </h4>
                        <a class="heading-elements-toggle">
                            <i class="fa fa-ellipsis-v font-medium-3"></i>
                        </a>
                        <div class="heading-elements">
                            <ul class="list-inline mb-0">
                                <li>
                                    <a href="{{ path('view_ProjectBacklog',{'id':backlog.id}) }}"><button type="button" class="btn mr-1 mb-1 btn-danger btn-sm" >Toutes les taches</button></a>
                                    <a class="btn btn-sm btn-success box-shadow-2 round btn-min-width pull-right"  >Points Done {{ backlog.pointsDone  }} </a>
                                    <a class="btn btn-sm btn-info box-shadow-2 round btn-min-width pull-right"  >Points In Progress {{  backlog.pointsInProgress }} </a>
                                    <a class="btn btn-sm btn-danger box-shadow-2 round btn-min-width pull-right"  >Points To Do {{ backlog.pointsToDo }}  </a>
                                </li>
                            </ul>
                        </div>
                    </div>

                </div>


                <!-- Bordered table start -->
                <div class="row" id="tableau1">
                    <div class="col-12">

                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title">Taches</h4>
                                <a class="heading-elements-toggle"><i class="la la-ellipsis-v font-medium-3">  </i></a>


                                <div class="heading-elements">
                                    <ul class="list-inline mb-0">
                                        <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
                                        <li><a data-action="reload"><i class="ft-rotate-cw"></i></a></li>
                                        <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
                                        <li><a data-action="close"><i class="ft-x"></i></a></li>
                                    </ul>
                                </div>

                            </div>
                            <fieldset class="form-group col-xl-4 col-lg-6 col-md-12">
                                <input type="email" class="form-control" id="myInput" placeholder="Chercher Tickets">
                            </fieldset>
                            <div class="card-content collapse show">
                                <div class="card-body">
                                    <p class="card-text userid" id="{{ app.user }}">
                                       <button type="button" id="{{ backlog.id }}"class="mestaches btn btn-info btn-min-width mr-1 mb-1"><i class="ft-pause"></i> Mes taches</button>
                                        <a href="{{ path('add_BacklogTask',{'id':backlog.id}) }}"><button type="button" class="btn mr-1 mb-1 btn-danger btn-sm" >Add a new task</button></a>
                                    </p>
                                </div>
                                <div class="table-responsive">
                                    <table id='table1' class="table dataTable zero-configuration table-bordered mb-0">
                                        <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Title</th>
                                            <th>State</th>
                                            <th>Priority</th>
                                            <th>Story Points</th>
                                            <th>Responsable</th>
                                            <th>Actions</th>
                                            <th>Archiver</th>


                                        </tr>
                                        </thead>
                                        <tbody id="myTasks">
                                        {% if tasks is not empty %}
                                            {% for task in tasks %}

                                                <tr>
                                                    <th scope="row">{{ task.id }}</th>
                                                    <td> <a href="{{ path('view_BacklogTask',{'id_b':backlog.id, 'id':task.id}) }}">{{ task.title }}</a></td>
                                                    <td>
                                                        <div class="badge badge-pill badge-border border-success success">{{ task.state }}</div></td>
                                                    <td>
                                                        <div class="badge badge-pill badge-secondary">
                                                            <i class="font-medium-4 icon-line-height ft-activity">
                                                                {{ task.priority }}
                                                            </i>
                                                        </div>
                                                        </td>
                                                    <td>
                                                        <div class="badge badge-pill badge-glow badge-primary">
                                                            <i class="font-medium-4 icon-line-height ft-award">{{ task.storyPoints }}
                                                            </i>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="badge badge-glow badge-pill badge-info">{{ task.user }}</div>
                                                    </td>
                                                    <td> <a href="{{ path('delete_BacklogTask',{'id_b':backlog.id, 'id':task.id}) }}"><span class="badge badge-pill badge-danger float-right badge-glow"><i class="ft-x"></i></span></a>
                                                    <a href="{{ path('update_BacklogTask',{'id_b':backlog.id, 'id':task.id}) }}"><span class="badge badge-primary badge-pill badge-glow float-right"><i class="ft-edit-2"></i></span></a> </td>
                                                    <td><a href="{{ path('archiver_BacklogTask',{'id_b':task.backlog.id, 'id':task.id, 'archive': 1}) }}"><button type="button" class="btn btn-outline-info mr-1"><i class="ft-book"></i></button>  </a></td>
                                                </tr>

                                            {% endfor %}

                                        {% else %}

                                        {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title">Archives</h4>
                                <a class="heading-elements-toggle"><i class="la la-ellipsis-v font-medium-3">  </i></a>


                                <div class="heading-elements">
                                    <ul class="list-inline mb-0">
                                        <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
                                        <li><a data-action="reload"><i class="ft-rotate-cw"></i></a></li>
                                        <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
                                        <li><a data-action="close"><i class="ft-x"></i></a></li>
                                    </ul>
                                </div>
                            </div>
                            <fieldset class="form-group col-xl-4 col-lg-6 col-md-12">
                                <input type="email" class="form-control" id="myInput2" placeholder="Chercher Tickets Dans l'archive">
                            </fieldset>

                            <div class="table-responsive">
                                <table id='table2' class="table dataTable zero-configuration table-bordered mb-0">
                                    <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Title</th>
                                        <th>State</th>
                                        <th>Priority</th>
                                        <th>Story Points</th>
                                        <th>Responsable</th>
                                        <th>Désarchiver</th>


                                    </tr>
                                    </thead>
                                    <tbody id="myTasksArchive">
                                    {% if archives is not empty %}
                                        {% for task in archives %}

                                            <tr>
                                                <th scope="row">{{ task.id }}</th>
                                                <td> <a href="{{ path('view_BacklogTask',{'id_b':backlog.id, 'id':task.id}) }}">{{ task.title }}</a></td>
                                                <td>
                                                    <div class="badge badge-pill badge-border border-success success">{{ task.state }}</div></td>
                                                <td>
                                                    <div class="badge badge-pill badge-secondary">
                                                        <i class="font-medium-4 icon-line-height ft-activity">
                                                            {{ task.priority }}
                                                        </i>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="badge badge-pill badge-glow badge-primary">
                                                        <i class="font-medium-4 icon-line-height ft-award">{{ task.storyPoints }}
                                                        </i>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="badge badge-glow badge-pill badge-info">{{ task.user.username }}</div>
                                                </td>

                                                <td><a href=" {{ path('archiver_BacklogTask',{'id_b':task.backlog.id, 'id':task.id, 'archive': 0}) }}">
                                                        <button type="button" class="btn btn-outline-danger btn-min-width box-shadow-5 mr-1 mb-1"><i class="ft-alert-octagon"></i>
                                                        </button>
                                                    </a>
                                                </td>
                                            </tr>

                                        {% endfor %}

                                    {% else %}

                                    {% endif %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title">Statistique</h4>
                            <a class="heading-elements-toggle"><i class="la la-ellipsis-v font-medium-3">  </i></a>


                            <div class="heading-elements">
                                <ul class="list-inline mb-0">
                                    <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
                                    <li><a data-action="reload"><i class="ft-rotate-cw"></i></a></li>
                                    <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
                                    <li><a data-action="close"><i class="ft-x"></i></a></li>
                                </ul>
                            </div>

                        </div>
                        <div class="card-content collapse show">
                            <div class="card-body">
                                <div class="table-responsive">
                                    <div id="div_chart">

                                    </div>
                                </div>

                            </div>
                        </div>

                    </div>


                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title">Statistique</h4>
                            <a class="heading-elements-toggle"><i class="la la-ellipsis-v font-medium-3">  </i></a>


                            <div class="heading-elements">
                                <ul class="list-inline mb-0">
                                    <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
                                    <li><a data-action="reload"><i class="ft-rotate-cw"></i></a></li>
                                    <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
                                    <li><a data-action="close"><i class="ft-x"></i></a></li>
                                </ul>
                            </div>

                        </div>
                        <div class="card-content collapse show">
                            <div class="card-body">
                                <div class="table-responsive">
                                    <div id="div_chart">
                                        hello
                                        {% include 'ADesignsCalendarBundle::calendar.html.twig' %}

                                    </div>
                                </div>

                            </div>
                        </div>

                    </div>

                </div>
                <!-- Bordered table end -->

    </div>
    </div>
    </div>


    <script>

        $(document).ready(function(){
            $("#myInput").on("keyup", function() {
                var value = $(this).val().toLowerCase();
                $("#myTasks tr").filter(function() {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });
        });


        $(document).ready(function(){
            $("#myInput2").on("keyup", function() {
                var value = $(this).val().toLowerCase();
                $("#myTasksArchive tr").filter(function() {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });
        });
    </script>


    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        {{ gc_draw(piechart, 'div_chart') }}
    </script>
    <script src="{{ asset('jquery-min.js') }}">
        </script>
<script>

        const mestaches = document.querySelectorAll('.mestaches');
        var bouton = document.getElementsByClassName('.mestaches');


        document.getElementById('{{ backlog.id }}').addEventListener('click', function (e) {
            console.log('*******************************');


            $.ajax({
                url : "{{ path('user_BacklogTask',{'id': backlog.id, 'id_u': app.user.id })  }}",
                type: 'GET'
            }).done(function (response) {
                var tableau1 = $(response).find("table");
                var tableau2 = $(response).find("table2");

                $('#tableau1').empty();

                $('#tableau1').append(tableau1);
            });

        });

    </script>



{%endblock%}



    {% block footer %}


    {% endblock %}
